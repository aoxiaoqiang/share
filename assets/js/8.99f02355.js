(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{319:function(t,a,s){"use strict";s.r(a);var n=s(11),e=Object(n.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"小程序优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#小程序优化","aria-hidden":"true"}},[t._v("#")]),t._v(" 小程序优化")]),t._v(" "),s("h2",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言","aria-hidden":"true"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),s("p",[t._v("在小程序官方文档中其实有一些"),s("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/performance/tips.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("优化建议"),s("OutboundLink")],1),t._v("，我们时常需要看看，其中最主要的是"),s("code",[t._v("setData")]),t._v("的优化。")]),t._v(" "),s("h3",{attrs:{id:"setdata"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#setdata","aria-hidden":"true"}},[t._v("#")]),t._v(" setData")]),t._v(" "),s("p",[t._v("由于微信小程序实现机制"),s("code",[t._v("setData")]),t._v("需要在视图层和逻辑层进行数据传输，这就有了性能瓶颈，所以我们需要做优化。")]),t._v(" "),s("h3",{attrs:{id:"图片"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#图片","aria-hidden":"true"}},[t._v("#")]),t._v(" 图片")]),t._v(" "),s("p",[t._v("目前图片资源的主要性能问题在于大图片和长列表图片上，这两种情况都有可能导致 iOS 客户端内存占用上升，从而触发系统回收小程序页面。")]),t._v(" "),s("p",[t._v("在 iOS 上，小程序的页面是由多个 WKWebView 组成的，在系统内存紧张时，会回收掉一部分 WKWebView。从过去我们分析的案例来看，大图片和长列表图片的使用会引起 WKWebView 的回收。")]),t._v(" "),s("p",[t._v("除了内存问题外，大图片也会造成页面切换的卡顿。我们分析过的案例中，有一部分小程序会在页面中引用大图片，在页面后退切换中会出现掉帧卡顿的情况。")]),t._v(" "),s("p",[t._v("当前我们建议开发者尽量减少使用大图片资源。")]),t._v(" "),s("h3",{attrs:{id:"包大小"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#包大小","aria-hidden":"true"}},[t._v("#")]),t._v(" 包大小")]),t._v(" "),s("p",[t._v("小程序一开始时代码包限制为 1MB，但我们收到了很多反馈说代码包大小不够用，经过评估后我们放开了这个限制，增加到 2MB 。代码包上限的增加对于开发者来说，能够实现更丰富的功能，但对于用户来说，也增加了下载流量和本地空间的占用。")]),t._v(" "),s("p",[t._v("开发者在实现业务逻辑同时也有必要尽量减少代码包的大小，因为代码包大小直接影响到下载速度，从而影响用户的首次打开体验。")]),t._v(" "),s("p",[t._v("在日常开发的时候，我们可能引入了一些新的库文件，而过了一段时间后，由于各种原因又不再使用这个库了，我们常常会只是去掉了代码里的引用，而忘记删掉这类库文件了。目前小程序打包是会将工程下所有文件都打入代码包内，也就是说，这些没有被实际使用到的库文件和资源也会被打入到代码包里，从而影响到整体代码包的大小。")]),t._v(" "),s("h3",{attrs:{id:"audits"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#audits","aria-hidden":"true"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/devtools/audits.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Audits"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("体验评分是一项给小程序的体验好坏打分的功能，它会在小程序运行过程中实时检查，分析出一些可能导致体验不好的地方，并且定位出哪里有问题，以及给出一些优化建议。")]),t._v(" "),s("h2",{attrs:{id:"优化点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优化点","aria-hidden":"true"}},[t._v("#")]),t._v(" 优化点")]),t._v(" "),s("p",[t._v("基于以上，提出下列优化项：")]),t._v(" "),s("ul",[s("li",[t._v("避免频繁"),s("code",[t._v("setData")])]),t._v(" "),s("li",[t._v("避免传递大数据")]),t._v(" "),s("li",[t._v("避免在后台进行"),s("code",[t._v("setData")])]),t._v(" "),s("li",[t._v("减小图片大小，按需引用图片")]),t._v(" "),s("li",[t._v("减小包大小")]),t._v(" "),s("li",[t._v("减少并发数")])]),t._v(" "),s("h2",{attrs:{id:"如何优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何优化","aria-hidden":"true"}},[t._v("#")]),t._v(" 如何优化")]),t._v(" "),s("p",[t._v("基于以上点我们需要做的")]),t._v(" "),s("h3",{attrs:{id:"如何避免频繁setdata"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何避免频繁setdata","aria-hidden":"true"}},[t._v("#")]),t._v(" 如何避免频繁"),s("code",[t._v("setData")])]),t._v(" "),s("p",[t._v("在一个事件循环内，将批量的"),s("code",[t._v("setData")]),t._v("进行合并")]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 现状")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Page")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onLoad")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// do something")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 期望")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Page")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onLoad")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// do something")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("有些情况，可能会频繁触发事件导致会频繁"),s("code",[t._v("setData")]),t._v(",比如"),s("code",[t._v("onScroll")]),t._v(","),s("code",[t._v("onTouchMove")]),t._v("等，我们应该怎么做呢？")]),t._v(" "),s("ul",[s("li",[t._v("使用节流函数")]),t._v(" "),s("li",[t._v("使用"),s("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/view/interactive-animation.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("wxs 响应事件"),s("OutboundLink")],1)])]),t._v(" "),s("h3",{attrs:{id:"如何避免传递大数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何避免传递大数据","aria-hidden":"true"}},[t._v("#")]),t._v(" 如何避免传递大数据")]),t._v(" "),s("p",[t._v("有以下几点")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("最小化更新\n比如我们需要更新某一项")]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Page")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("method")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 错误示例, 当数据小的时候没事")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" item "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" item "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 正确示例")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'item.a'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("其实我们日常开发中碰到大部分情况是长列表分页加载，如果我们每次都将获取新数据"),s("code",[t._v("concat")]),t._v("到长列表数据中再"),s("code",[t._v("setData")]),t._v(", 这样数据会越来越多导致数据超出或者慢等情况，那我们也可以以这种方式更新数据。")]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Page")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("load")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" newdata "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMoreData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 分页加载拿到的数据")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" newList "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 以下是示例用代码，不严谨")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" len "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" arr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" item "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newData"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      newList"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("`list[")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("len "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("]`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newList"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("优先更新-延迟更新\n当我们可能一次性拿到比较大的数据时，我们可能会直接"),s("code",[t._v("setData")]),t._v("，就会造成性能问。")]),t._v(" "),s("p",[t._v("我们可以优先更新可视区域内的数据，之后再更新可视区域外的区域，这样避免一次性设置过多数据导致慢、卡顿等问题。")])]),t._v(" "),s("li",[s("p",[t._v("按需更新")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/wechat-miniprogram/recycle-view",target:"_blank",rel:"noopener noreferrer"}},[t._v("recycle-view"),s("OutboundLink")],1),t._v(" 是一个很好的例子，原理如下图（"),s("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/34585166",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://zhuanlan.zhihu.com/p/34585166"),s("OutboundLink")],1),t._v("）")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://pic3.zhimg.com/80/v2-f00bb3f5d9815d660d7bcbd87236af86_hd.jpg",alt:"img"}})]),t._v(" "),s("p",[t._v("只在可视区域内显示节点信息 ，其他的用占位替代，这样我们就可以到达按需更新的目的。在长列表或者瀑布流等需要展示很多数据并且有规律的场景下是"),s("strong",[t._v("很有用处的")]),t._v("。")])])]),t._v(" "),s("h3",{attrs:{id:"图片优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#图片优化","aria-hidden":"true"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.yuque.com/ysfe/ykx/imgopt",target:"_blank",rel:"noopener noreferrer"}},[t._v("图片优化"),s("OutboundLink")],1)]),t._v(" "),s("ul",[s("li",[s("p",[t._v("减少图片大小")]),t._v(" "),s("p",[t._v("我们使用七牛 cdn，七牛提供了相对丰富的"),s("a",{attrs:{href:"https://developer.qiniu.com/dora/manual/1279/basic-processing-images-imageview2",target:"_blank",rel:"noopener noreferrer"}},[t._v("api"),s("OutboundLink")],1),t._v("可以动态改变图片大小等功能")]),t._v(" "),s("p",[t._v("like: http://odum9helk.qnssl.com/resource/gogopher.jpg?imageView2/1/w/200/h/200")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://user-images.githubusercontent.com/4362412/56707577-0a548f00-674c-11e9-8c16-461d31f54f90.png",alt:"1556162364876"}})])]),t._v(" "),s("li",[s("p",[t._v("按需引用图片")]),t._v(" "),s("p",[t._v("按照样式稿，基本能确定所需图片的宽高, 这样就能极大的减少图片大小。我们也有相应的"),s("strong",[t._v("方法")]),t._v("得到处理过的图片地址。")])])]),t._v(" "),s("h3",{attrs:{id:"减少包大小"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#减少包大小","aria-hidden":"true"}},[t._v("#")]),t._v(" 减少包大小")]),t._v(" "),s("ul",[s("li",[t._v("查找代码，分析出不需要的代码并删除")]),t._v(" "),s("li",[t._v("通过"),s("strong",[t._v("audits")]),t._v("分析，查找那些页面有 wxss 可能有优化空间")]),t._v(" "),s("li",[t._v("等等")])]),t._v(" "),s("h3",{attrs:{id:"减少并发"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#减少并发","aria-hidden":"true"}},[t._v("#")]),t._v(" 减少并发")]),t._v(" "),s("p",[t._v("在 audits 分析中，有两个比较突出的是多图片并发和多请求并发，这是优化重点及难点。")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("减少图片请求并发")]),t._v(" "),s("ul",[s("li",[t._v("使用"),s("code",[t._v("image")]),t._v("标签中得"),s("code",[t._v("lazy-load")]),t._v("属性，可以延迟加载图片")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://user-images.githubusercontent.com/4362412/56708640-0c205180-6750-11e9-9591-ee5f706268d8.png",alt:"image"}})]),t._v(" "),s("p",[t._v("但是是在上下三屏开始加载，这个阈值不能设置，可能需要我们自己实现一个满足需求。\n当然我们可以考虑更好的解决方案。")]),t._v(" "),s("ul",[s("li",[t._v("尽可能使用"),s("code",[t._v("iconfont")]),t._v(" 或 css实现一些图标， 而不是引入一张图片")])])]),t._v(" "),s("li",[s("p",[t._v("减少请求并发数")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("根据实际情况优先请求首屏展示的内容，延后请求非首屏内容。")])]),t._v(" "),s("li",[s("p",[t._v("查看是否有重复的请求，能否减少。")])]),t._v(" "),s("li",[s("p",[t._v("使用"),s("code",[t._v("lazy-component")])]),t._v(" "),s("p",[t._v("当我们把页面拆分成多个组件展示时，每个组件独立请求的情况下，这个时候我们需要引入延迟加载组件"),s("code",[t._v("lazy-component")]),t._v(",效果和"),s("code",[t._v("image")]),t._v("组件的"),s("code",[t._v("lazy-load")]),t._v("类似，当组件在可视区域内时初始化，不在可视区域内则不初始化。")])])])])])])},[],!1,null,null,null);a.default=e.exports}}]);